---
title: 触发器
createTime: 2024/12/19 14:07:12
permalink: /database/131xnl8p/
---

在实际开发中，我们将常会遇到这样的情况：有 2 个或者多个相互关联的表，如商品信息和库存信息分别存放在 2 个不同的数据表中，我们在添加一条新商品记录的时候，为了保证数据的完整性，必须同时在库存表中添加一条库存记录。

这样一来，我们就必须把这两个关联的操作步骤写到程序里面，而且要用事物包裹起来，确保这两个操作成为一个院子操作，要么全部执行，要么全部不执行。要是遇到特殊的情况，可能还需要对数据进行手动维护，这样就很容易忘记其中的一步，导致数据缺失。

这个时候，咱们就可以使用触发器。你可以创建一个触发器，让商品信息数据的插入操作自动触发库存数据的插入操作。这样一来，即不同担心忘记添加库存数据二导致的数据缺失了。

### 1. 触发器的概述

MySQL 从 5.0.2 版本开始支持触发器。MySQL 的触发器和存储过程一样，都是嵌入到 MySQL 服务器的一段程序。触发器是由时间来出发某个操作，这些事件包括 INSERT、UPDATE、DELETE 事件。所谓事件就是指用户的动作或者出发某项行为。如果定义了出发程序，当数据库执行这些语句时候，就相当于事件发生了，就会自动激发触发器执行相应的操作。

当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来实现。

### 2. 触发器的创建

#### 2.1 创建触发器语法

```sql
CREATE TRIGGER 触发器名称
{BEFORE | AFTER} {INSERT|UPDATE|DELETE} ON 表名
FOR EACH ROW
触发器执的语句快;  
```

- 表名：表示触发器监控的对象
- `BEFORE|AFTER`：表示触发的时间。BEFORE 表示在事件之前触发；AFTER 表示在事件之后触发。
- `INSERT|UPDATE|DELETE`：表示出发的事件。
    - INSERT 表示插入记录时触发；
    - UPDATE 表示更新记录时触发；
    - DELETE 表示删除记录时触发。
- `触发器执行的语句块`：可以是单条 SQL 语句，也可以是由 `BEGIN ... END` 结构组成的复合语句块。

### 3. 查看、删除触发器

#### 3.1 查看触发器

查看触发器是查看数据库中已经存在的触发器的定义、状态和语法信息等。

```sql
# 方式一：查看当前数据库的所有触发器的定义
SHOW TRIGGER \G

# 方式二：查看当前数据库中某个触发器的定义
SHOW CREATE TRIGGER 触发器名;

# 方式三：从系统库 information_schema 的 TRIGGERS 表中查询 “salary_check_trigger” 触发器的信息。
SELECT * FROM information_schema.TRIGGERS;
```

#### 3.2 删除触发器

触发器也是数据库对象，删除触发器也用 DROP 语句，语法格式如下：

```sql
DROP TRIGGER IF EXISTS 触发器名称;
```

### 4. 触发器的优缺点

#### 4.1 优点

- 触发器可以确保数据的完整性。
- 触发器可以帮助我们记录操作日志。
- 触发器还可以用在操作数据钱，对数据进行合法性检查。

#### 4.2 缺点

- 触发器最大的一个问题就是可读性差。
- 相关数据的变更，可能会导致触发器出错。

#### 4.3 注意点

注意：如果在子表中定义了外键约束，并且外键制定了 `ON UPDATE/DELETE CASCADE/SET NULL` 子句，此时修改父表被引用的键值或删除父表被引用的记录时，也会引起子表的修改和删除操作，此时基于子表的 UPDATE 和 DELETE 语句定义的触发器并不会被激活。